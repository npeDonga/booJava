<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">title</title>


    <link href="/bootstrap/css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/bootstrap/css/flat-ui.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="all"
          href="/css/total.css" />
</head>
<body>
    <div class="navv">
        <ul class="container">
            <li><a href="/manage/list">회원목록</a></li>
            <li>|</li>
            <li><a href="/letter/write">쪽지</a></li>
            <li>|</li>
            <li><a href="/attend/list">참석여부</a></li>
            <li>|</li>
            <li><a class="active" href="/send/list">보냄</a></li>
        </ul>
    </div> <!-- End Nav -->
    <div class="container">
        <div class="flat-form">
            <ul class="tabs">
                <li>
                    <a href="#tab_notice" class="active" onclick="loadUserList(1)">공지사항</a>
                </li>
                <li>
                    <a href="#tab_attend" onclick="loadUserList_circle(1)">참석여부</a>
                </li>
            </ul>
            <!--  tabs 끝 -->
            <!--@thymesVar id="noticeCount" type="String"-->
            <!--@thymesVar id="circleCount" type="String"-->
            <div id="tab_notice" class="form-action show">
                <table class="manage_users_table">
                </table>
                <div class="pageDiv">
                    <ul class="pagination">
                        <li class="previous"><a href="#fakelink" class="fui-arrow-left"></a></li>
                        <hidden th:each="i : ${#numbers.sequence(1,noticeCount)}">
                            <li><a th:text="${i}" th:onclick="${'javascript:loadUserList(' + i + ')'}"></a></li>
                        </hidden>
                        <li class="next"><a href="#fakelink" class="fui-arrow-right"></a></li>
                    </ul>
                </div> <!-- /pagination -->
            </div>
            <div id="tab_attend" class="form-action hide">
                <table class="manage_users_table">
                </table>
                <div class="pageDiv">
                    <ul class="pagination">
                        <li class="previous"><a href="#fakelink" class="fui-arrow-left"></a></li>
                        <hidden th:each="i : ${#numbers.sequence(1,circleCount)}">
                            <li><a th:text="${i}" th:onclick="${'javascript:loadUserList_circle(' + i + ')'}"></a></li>
                        </hidden>
                        <li class="next"><a href="#fakelink" class="fui-arrow-right"></a></li>
                    </ul>
                </div> <!-- /pagination -->
            </div>
        </div>
        <!--flat_form 끝  -->
    </div>
    <!-- jQuery (necessary for Flat UI's JavaScript plugins) -->
    <script src="/bootstrap/js/vendor/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/bootstrap/js/vendor/video.js"></script>
    <script src="/bootstrap/js/flat-ui.min.js"></script>
    <script class="cssdeck" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script>
        (function( $ ) {
            // constants
            var SHOW_CLASS = 'show',
                HIDE_CLASS = 'hide',
                ACTIVE_CLASS = 'active';

            $( '.tabs' ).on( 'click', 'li a', function(e){
                e.preventDefault();
                var $tab = $( this ),
                    href = $tab.attr( 'href' );

                $( '.active' ).removeClass( ACTIVE_CLASS );
                $tab.addClass( ACTIVE_CLASS );

                $( '.show' )
                    .removeClass( SHOW_CLASS )
                    .addClass( HIDE_CLASS )
                    .hide();

                $(href)
                    .removeClass( HIDE_CLASS )
                    .addClass( SHOW_CLASS )
                    .hide()
                    .fadeIn( 550 );


            });
        })( jQuery );
    </script>
    <script th:inline="javascript">
        var count = [[${count}]];
        var currentMaxIndex = 1;
        $("document").ready(loadUserList(1));
        $("document").ready(makePagination());

        function previousPage(){
            if (count<currentMaxIndex){
                $("#showPage").empty();
                for (var i = makeStartNumber(currentMaxIndex); i<makeFarFiveTime(currentMaxIndex)+1; i++){
                    $("#showPage").append("<li><a onclick=loadUserList("+(i)+")>"+(i)+"</a></li>");
                }
                currentMaxIndex = makeStartNumber(currentMaxIndex)+5;
                loadUserList(makeStartNumber(currentMaxIndex));
            }
        }

        function nextPage(){
            if (count>currentMaxIndex){
                $("#showPage").empty();
                for (var i = currentMaxIndex; i<makeCloseFiveTime(currentMaxIndex); i++){
                    $("#showPage").append("<li><a onclick=loadUserList("+(i)+")>"+(i)+"</a></li>");
                    currentMaxIndex++;
                }
                console.log(currentMaxIndex);
                loadUserList(makeStartNumber(currentMaxIndex));
            }
        }

        function makePagination() {
            if (count<5) {
                for (var i = 0; i<count; i++){
                    $("#showPage").append("<li><a onclick='loadUserList(currentMaxIndex+1)'>test</a></li>");
                }
            }else{
                for (var i = 0; i<5; i++){
                    $("#showPage").append("<li><a onclick=loadUserList("+(currentMaxIndex)+")>"+(currentMaxIndex)+"</a></li>");
                    currentMaxIndex++;
                }
            }
        }

        function makeCloseFiveTime(count){
            if (count%5==1){
                return count+4;
            }else if (count%5==2){
                return count+3;
            }else if (count%5==3){
                return count+2;
            }else if (count%5==4){
                return count+1;
            }else{
                return count;
            }
        }

        function makeFarFiveTime(count){
            if (count%5==1){
                return count-1;
            }else if (count%5==2){
                return count-2;
            }else if (count%5==3){
                return count-3;
            }else if (count%5==4){
                return count-4;
            }else{
                return count-5;
            }
        }

        function makeStartNumber(count){
            if (count%5==1){
                return count-5;
            }else if (count%5==2){
                return count-6;
            }else if (count%5==3){
                return count-7;
            }else if (count%5==4){
                return count-8;
            }else{
                return count-9;
            }
        }

        function loadUserList(index) {
            $.ajax({
                type: "GET",
                url: "/send/api/normal/"+index,
                error: function () {
                    alert("통신실패!");
                },
                success : function (data) {

                    $(".manage_users_table").empty();
                    $(".manage_users_table").append("<tr><th>번호</th><th>제목</th><th>내용</th><th>날짜</th></tr>");
                    for (var i in data) {
                        console.log(data[i]);
                        $(".manage_users_table").append("<tr><td>"+data[i]['id']+"</td>"
                            +"<td>"+data[i]['title']+"</td>"
                            +"<td>"+data[i]['body']+"</td>"
                            +"<td>"+data[i]['updated_at']+"</td></tr>");
                    }
                }
            });
        }

        function loadUserList_circle(index) {

            $.ajax({
                type: "GET",
                url: "/send/api/circle/"+index,
                error: function (request,status,error) {
                    console.log("request : "+request+"| status : "+status+"| error : "+error)
                },
                success : function (data) {

                    $(".manage_users_table").empty();
                    $(".manage_users_table").append("<tr><th>번호</th><th>제목</th><th>내용</th><th>날짜</th></tr>");
                    for (var i in data) {
                        console.log(data[i]);
                        $(".manage_users_table").append("<tr><td>"+data[i]['id']+"</td>"
                            +"<td>"+data[i]['title']+"</td>"
                            +"<td>"+data[i]['body']+"</td>"
                            +"<td>"+data[i]['updated_at']+"</td></tr>");
                    }
                }
            });
        }
    </script>
</body>
</html>